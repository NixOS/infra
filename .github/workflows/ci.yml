name: CI

on:
  push:
    branches:
      - master
  pull_request:
  merge_group:

permissions:
  contents: read

jobs:
  nix-fmt:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: cachix/install-nix-action@v27
    - run: nix fmt -- --no-cache --fail-on-change

  # We probably should replace with a different faster CI soon,
  # but atleast this gives us confidence for now
  nix-build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: cachix/install-nix-action@v27
    - run: nix run github:Mic92/nix-fast-build -- --no-nom
